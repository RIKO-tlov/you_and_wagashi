<div class="container text-center">
  <%= render 'public/shops/main', shop: @shop %>
  <div class="row">
    <div class="col-sm-5 mx-auto my-3">
      <h5 class="font-weight-bold">住所</h5>
        <p><%= @shop.address %></p>
      <h5 class="font-weight-bold">店舗概要</h5>
        <p><%= @shop.description %></p>
      <h5 class="font-weight-bold">URL</h5>
        <p><%= @shop.url %></p>
      <h5 class="font-weight-bold">定休日</h5>
          <p><%= @shop.holiday %></p>
      <h5 class="font-weight-bold">営業時間</h5>
        <!-- &.で空の時nilを渡す -->
        <%= @shop.bussiness_start_time&.strftime( "%H:%M" ) %>～<%= @shop.bussiness_end_time&.strftime( "%H:%M" ) %>
      <h5 class="font-weight-bold mt-3">電話番号</h5>
        <p><%= @shop.telephone_number %></p>
      <h5 class="font-weight-bold"><i class="fas fa-share"></i>share</h5>
        <!-- 店名付きでSNS投稿 -->
        <p><%= social_share_button_tag(@shop.name) %></p>
      <%= render 'public/shops/buttons', shop: @shop %>
    </div>
  </div>
  <% if @reviews.present? %>
  <div class="row">
    <div class="col-sm-12 mx-auto my-5">
      <!--総合星評価-->
      <div id="average-rating">
        <h4 class="mb-3">総評価：<%= @reviews.average(:rate).to_f.round(1) %>点</h4>
        <script>
          $('#average-rating').raty({
            size: 36,
            starOff: '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: <%= @reviews.average(:rate) %>,
          });
        </script>
      </div>
      <!--/総合星評価-->
      <p class="mt-3">レビュー<%= @reviews.count %>件 | <%= link_to "レビューを書く", new_shop_review_path(@shop) %></p>
    </div>
  </div>
  <div class="row reviews py-3">
    <% @reviews.each do |review| %>
    <div class="col-sm-3">
      <p class="posts-prof">投稿者 <%= review.user.name %> <%= review.user.sex %></p>
      <p><%= l review.created_at, format: :short %></p>
    </div>
    <div class="col-sm-2">
      <%= attachment_image_tag review, :product_image, :fill, 100, 100, format: 'jpeg', fallback: "no_image.png", size:"100x100" %>
    </div>
    <div class="col-sm-4">
      <p class="font-weight-bold mt-2"><%= review.product_name %></p>
      <p><%= review.comment %></p>
      <!--ジャンル-->
      <div class="star_review">
        <p class="mb-1">評価：<%= review.rate %>点</p>
        <!--星評価-->
        <div id="star-rate-<%= review.id %>"></div>
        <script>
          $('#star-rate-<%= review.id %>').raty({
            size: 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: <%= review.rate %>,
          });
        </script>
        <!--/星評価-->
      </div>
    </div>
    <div class="col-sm-3 edit-button">
      <% if current_user == review.user %>
        <%= link_to '編集', edit_shop_review_path(review.shop, review), method: :get, class:'btn btn-dark mt-5' %>
        <%= link_to '削除', shop_review_path(review.shop, review), method: :delete, class:'btn btn-dark mt-5' %>
      <% end %>
    </div>
    <% end %>
  <% else %>
    <div class="row">
      <div class="col-sm-12 mx-auto">
        <h2>レビューはありません</h2>
        <p class="mt-3">レビュー<%= @reviews.count %>件 | <%= link_to "レビューを書く", new_shop_review_path(@shop) %></p>
      </div>
    </div>
  <% end %>
  </div>
</div>


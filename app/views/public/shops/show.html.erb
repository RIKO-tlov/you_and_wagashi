<div class="container text-center">
  <%= render 'public/shops/main', shop: @shop %>
  <div class="row">
    <div class="col-sm-5 mx-auto my-3">
      <h5 class="font-weight-bold">住所</h5>
        <p><%= @shop.address %></p>
      <h5 class="font-weight-bold">店舗概要</h5>
        <p><%= @shop.description %></p>
      <h5 class="font-weight-bold">URL</h5>
        <p><%= @shop.url %></p>
      <h5 class="font-weight-bold">定休日</h5>
          <p><%= @shop.holiday %></p>
      <h5 class="font-weight-bold">営業時間</h5>
        <!-- &.で空の時nilを渡す -->
        <%= @shop.bussiness_start_time&.strftime( "%H:%M" ) %>～<%= @shop.bussiness_end_time&.strftime( "%H:%M" ) %>
      <h5 class="font-weight-bold mt-3">電話番号</h5>
        <p><%= @shop.telephone_number %></p>
      <h5 class="font-weight-bold"><i class="fas fa-share"></i>share</h5>
        <!-- 店名付きでSNS投稿 -->
        <p><%= social_share_button_tag(@shop.name) %></p>
      <div id="visits_buttons">
        <%= render 'public/shops/visits_buttons', shop: @shop %>
      </div>
      <div id="wishes_buttons">
        <%= render 'public/shops/wishes_buttons', shop: @shop %>
      </div>
    </div>
  </div>
  <% if @reviews.present? %>
  <div class="row">
    <div class="col-sm-12 mx-auto my-5">
      <!--総合星評価-->
      <div id="average-rating">
        <h4 class="mb-3">総評価：<%= @reviews.average(:rate).to_f.round(1) %>点</h4>
        <script>
          $('#average-rating').raty({
            size: 36,
            starOff: '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: <%= @reviews.average(:rate) %>,
          });
        </script>
      </div>
      <!--/総合星評価-->
      <p class="mt-3">レビュー<%= @reviews.count %>件 | <%= link_to "レビューを書く", new_shop_review_path(@shop), class:"link" %></p>
    </div>
  </div>
  <div class="row reviews">
    <% @reviews.each do |review| %>
    <div class="col-sm-8 mx-auto">
      <table class="table pt-3">
        <tbody>
          <tr>
            <td style="width: 20%">
              <p class="posts-prof">投稿者：<%= review.user.name %><%= review.user.sex %></p>
              <p><%= l review.created_at, format: :short %></p>
            </td>
            <td style="width: 10%"><%= attachment_image_tag review, :product_image, :fill, 100, 100, format: 'jpeg', fallback: "no_image.png", size:"100x100", class:"mt-2" %></td>
            <td style="width: 40%">
              <p class="font-weight-bold"><%= review.product_name %></p>
              <p><%= review.comment %></p>
              <!--ジャンル-->
            </td>
            <td style="width: 40%">
              <div class="star_review">
                <p>評価：<%= review.rate %>点</p>
                <!--星評価-->
                <div id="star-rate-<%= review.id %>"></div>
                <script>
                  $('#star-rate-<%= review.id %>').raty({
                    size: 36,
                    starOff:  '<%= asset_path('star-off.png') %>',
                    starOn : '<%= asset_path('star-on.png') %>',
                    starHalf: '<%= asset_path('star-half.png') %>',
                    half: true,
                    readOnly: true,
                    score: <%= review.rate %>
                  });
                </script>
                <!--/星評価-->
              </div>
              <% if current_user == review.user %>
                <%= link_to edit_shop_review_path(review.shop, review), method: :get, class:'btn-flat-bottom-border mr-2 mt-5' do %>
                  <i class="far fa-edit"></i>
                <% end %>
                <%= link_to shop_review_path(review.shop, review), method: :delete, class:'btn-flat-bottom-border-delete mt-5' do %>
                  <i class="far fa-trash-alt"></i>
                <% end %>
              <% end %>
            </td>
        </tbody>
      </table>
    </div>
    <% end %>
  </div>
  <% else %>
    <div class="row">
      <div class="col-sm-12 mx-auto">
        <h2>レビューはありません</h2>
        <p class="mt-3">レビュー<%= @reviews.count %>件 | <%= link_to "レビューを書く", new_shop_review_path(@shop), class:"link" %></p>
      </div>
    </div>
  <% end %>
  </div>
</div>

